<div class="uk-section-default uk-section uk-section-small uk-padding-remove-top uk-padding-remove-bottom" style="min-height: 90vh;">
  <div class="uk-container uk-container-expand uk-margin-left uk-margin-right">

    @if (currentResourceGuideline) {
      <div class="uk-margin-large-top">
        <h3>{{currentResourceGuideline.title}}</h3>
      </div>
    }

    @if (showLoader) {
      <div class="uk-margin-large-top">
        <div class="loader-big"></div>
      </div>
    }

    @if (displayMessage) {
      <div class="uk-margin-large-top">
        <span class="">{{displayMessage}}</span>
      </div>
    }

    @if (templates?.length>0) {
      @if (errorMessage) {
        <div id="errorAlert" class="uk-alert-danger" uk-alert>
          <a class="uk-alert-close" uk-close></a>
          <pre class="uk-alert-danger">{{errorMessage}}</pre>
        </div>
      }
      @if (ready) {
        <div class="uk-grid-small uk-margin-top" uk-grid>
          @for (template of templates; track template; let i = $index) {
            <div [ngClass]="{'uk-width-1-2@m': templates.length <= 2, 'uk-width-1-3@m': templates.length > 2}">
                <pre *ngIf="this.isDevMode()">{{ formModels[template.id]?.id | json }}</pre>
                @if (formModels[template.id]) {
                  @if (saveMessageMap[template.id]) {
                    <div [ngClass]="{
                         'uk-alert-success': saveMessageMap[template.id].includes('success'),
                         'uk-alert-danger': saveMessageMap[template.id].includes('fail'),
                         'uk-alert': true
                       }" uk-alert>
                    <a class="uk-alert-close" uk-close (click)="saveMessageMap[template.id] = ''"></a>
                    <p>{{ saveMessageMap[template.id] }}</p>
                    </div>
                  }
                <app-survey #survey
                  [payload]="answersByTemplateId[template.id]"
                  [model]="formModels[template.id]"
                  [vocabulariesMap]="vocabulariesMap"
                  [subVocabularies]="subVocabulariesMap"
                  [tabsHeader]=""
                  [activeUsers]="[]"
                  (submit)="saveForm($event, template.id)">
                  <div class="uk-grid form-top-section">
                    <h5 class="uk-width-1-1 uk-margin-bottom">{{ formModels[template.id].name }}</h5>
                    <p class="uk-margin-bottom" [innerHTML]="formModels[template.id].notice"></p>
                  </div>
                  <div class="form-action-bar titleAndActionsBar uk-flex uk-flex-right justify-content-end">
                    <button class="uk-button uk-button-secondary uk-margin-left"
                    (click)="children.toArray()[i].parentSubmit()">Save</button>
                  </div>
                </app-survey>
<!--                    <pre *ngIf="this.isDevMode()">{{getAnswerForTemplate(template.id)|json}}</pre>-->
              }
            </div>
          }
        </div>
      }
    }

  </div>
</div>

<ng-container *ngIf="this.isDevMode()">
  <pre>{{this.payloadAnswer|json}}</pre>
</ng-container>
